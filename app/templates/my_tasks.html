
{% extends 'base.html' %}

{% block title %}
Мои задачи
{% endblock %}

{% block body %}
<link rel="stylesheet" href="{{ url_for ('static', filename='css/my_task.css')}}">
<link rel="stylesheet" href="{{ url_for ('static', filename='css/my_projects.css')}}">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
<script src="{{ url_for ('static', filename='js/jquery.min.js')}}"></script>
<script type='text/javascript'>
  // Стандарный input для файлов
  var fileInput = $('#file-field');
    
  // ul-список, содержащий миниатюрки выбранных файлов
  var imgList = $('ul#img-list');

  // Контейнер, куда можно помещать файлы методом drag and drop
  var dropBox = $('#img-container');

  // Обработка события выбора файлов в стандартном поле
  fileInput.bind({
    change: function() {
      displayFiles(this.files);
    }
  });
    
  // Обработка событий drag and drop при перетаскивании файлов на элемент dropBox
  dropBox.bind({
    dragenter: function() {
      $(this).addClass('highlighted');
      return false;
    },
    dragover: function() {
      return false;
    },
    dragleave: function() {
      $(this).removeClass('highlighted');
      return false;
    },
    drop: function(e) {
      var dt = e.originalEvent.dataTransfer;
      displayFiles(dt.files);
      return false;
    }
  });
    function displayFiles(files) {
        // Создаем элемент li и помещаем в него название, миниатюру и progress bar,
        // а также создаем ему свойство file, куда помещаем объект File (при загрузке понадобится)
        var li = $('<li/>').appendTo(imgList);
        $('<div/>').text(file.name).appendTo(li);
        var img = $('<img/>').appendTo(li);
        $('<div/>').addClass('progress').text('0%').appendTo(li);
        li.get(0).file = file;
  
        // Создаем объект FileReader и по завершении чтения файла, отображаем миниатюру и обновляем
        // инфу обо всех файлах
        var reader = new FileReader();
        reader.onload = (function(aImg) {
          return function(e) {
            aImg.attr('src', e.target.result);
            aImg.attr('width', 150);
            /* ... обновляем инфу о выбранных файлах ... */
          };
        })(img);
        
        reader.readAsDataURL(file);
      }
    
      function uploadFile(file, url) {
    
        var reader = new FileReader();
      
        reader.onload = function() {    
          var xhr = new XMLHttpRequest();    
          
          xhr.upload.addEventListener("progress", function(e) {
            if (e.lengthComputable) {
              var progress = (e.loaded * 100) / e.total;
              /* ... обновляем инфу о процессе загрузки ... */
            }
          }, false);
          
          /* ... можно обрабатывать еще события load и error объекта xhr.upload ... */
      
          xhr.onreadystatechange = function () {
            if (this.readyState == 4) {
              if(this.status == 200) {
                /* ... все ок! смотрим в this.responseText ... */
              } else {
                /* ... ошибка! ... */
              }
            }
          };
          
          xhr.open("POST", url);
          var boundary = "xxxxxxxxx";    
          // Устанавливаем заголовки
          xhr.setRequestHeader("Content-Type", "multipart/form-data, boundary="+boundary);
          xhr.setRequestHeader("Cache-Control", "no-cache");    
          // Формируем тело запроса
          var body = "--" + boundary + "\r\n";
          body += "Content-Disposition: form-data; name='myFile'; filename='" + file.name + "'\r\n";
          body += "Content-Type: application/octet-stream\r\n\r\n";
          body += reader.result + "\r\n";
          body += "--" + boundary + "--";
      
          if(xhr.sendAsBinary) {
            // только для firefox
            xhr.sendAsBinary(body);
          } else {
            // chrome (так гласит спецификация W3C)
            xhr.send(body);
          }
        };
        // Читаем файл
        reader.readAsBinaryString(file);
      }

</script>
<!--<h1>Задачи</h1>-->

<!-- 
<script>
  document.querySelector('#p1').addEventListener('mdl-componentupgraded', function() {
    this.MaterialProgress.setProgress(44);
  });
</script> -->
<div class="search-menu">
  <div class="navigation">

   <div class="tabs">
    <input type="radio" name="tab-btn" id="tab-btn-1" value="" checked>
    <label for="tab-btn-1">В процессе</label>
    <input type="radio" name="tab-btn" id="tab-btn-2" value="">
    <label for="tab-btn-2">Дедлайн</label>
    <input type="radio" name="tab-btn" id="tab-btn-3" value="">
    <label for="tab-btn-3">Выполнено</label>
  
  </div> 
  <input type="text" id="Search" onkeyup="functionSearch1()" placeholder="Введите имя">
  </div>
</div>
<div class="context-menu"> 
<!-- Блок "в процессе" -->
      {% for u in tasks %}
      {% if current_user.id == u.idUser %}
      <ul class="tasks_list" id="content-1">
         {% if u.statusСompleted == "Uncomplete" %}
         {%if u.timeTask != today %}
         <li>
         <a class ="triggerTask" href="#">
          <div class="task-card" >
      
            <p class="task-fname">{{u.nameTask}}</p>
  
      </div>
      </a>
            <div class = "task" id="tg{{u.id}}">
              <div class="task-up">
                <div class="finish-task"><a  value="{{u.id}}" name="task_into"> <p>Отправить на проверку</p></a></div>
                <div class="downloads"> <a href=""> <p> Загруженные файлы</p></a></div>
        </div>
              <div class="task-info">
              <p class="task_name">{{u.nameTask}}</p>
              <p class="proj_name"><span>Для проекта: </span>{{u.idProject}}</p>
              <p class="task-descript">{{u.descTask}}</p> 
              <div class="task-date"> <p> {{u.timeTask}}</p></div>
              <div class="task-money"> <p>{{u.manyTask}}</p></div>
            <form class="btns" method="post" enctype="multipart/form-data">
              <div class="actions">
                
              <!-- <div class="example-2"> эта хуйня ломает описание задачи-->
                <div class="form-group">
                  <input type="file" name="file" id="file" class="input-file" multiple>
                  <label for="file" class="btn">
                    <span class="btn btn-tertiary js-labelFile">Загрузить файл</span>
                  </label>
                <!-- </div> -->
              </div>
              </div>
               </form>
              </div>
              <form  method="POST">
                <div class="chat_name">
                  <ul class="chat-massages">
                      <li class="chat-mass">
                         <div class="mass-ava"> </div>
                            <div class="mass-text">
                               
                                    тут огромный огромный огромный огромныйогромный огромныйогромный огромныйогромный огромныйогромный огромный текст
                                
                            </div>
                      </li>
                      <li class="chat-mass">
                        <div class="mass-ava"> </div>
                           <div class="mass-text">
                               
                                   тут еще больше больше большк большк большк большк большк больше больше большк большк большк большк большкбольше больше большк большк большк большк большкбольше больше большк большк большк большк большкбольше больше большк большк большк большк большкбольше больше большк большк большк большк большкбольше больше большк большк большк большк большкбольше больше большк большк большк большк большк текст
                               
                           </div>
                     </li>
                     
                  </ul>
                </div>
                <div class="chat">
                    <input class="chat-text" name="text" type="text">
                    <input  class="chat-send" type="submit" value="отправить сообщение">
                    </div>
            </form>
              <!-- <button class="finish-task" value="{{u.id}}" name="task_into"><span>Отправить на проверку</span></button> -->
              <div class="cl-btn-7"></div>
              </div>
 
 

            
        </li>
        {% endif %}

        {% endif %}

      </ul>
      {% endif %}
      {% endfor %}

      <!-- Блок "дедлайн" -->
      {% for u in tasks %}
      {% if current_user.id == u.idUser %}
      <ul class="tasks_list" id="content-2">
         {% if u.statusСompleted == "Uncomplete" %}
         {%if u.timeTask == today %}
         <li>
         <a class ="triggerTask" href="#">
          <div class="task-card" >
      
            <p class="task-fname">{{u.nameTask}}</p>
  
      </div>
      </a>
            <div class = "task" id="tg{{u.id}}">
              <div class="task-up">
                <div class="finish-task"><a  value="{{u.id}}" name="task_into"> <p>Отправить на проверку</p></a></div>
                <div class="downloads"> <a href=""> <p> Загруженные файлы</p></a></div>
        </div>
              <div class="task-info">
              <p class="task_name">{{u.nameTask}}</p>
              <p class="proj_name"><span>Для проекта: </span>{{u.idProject}}</p>
              <p class="task-descript">{{u.descTask}}</p> 
              <div class="task-date"> <p> {{u.timeTask}}</p></div>
              <div class="task-money"> <p>{{u.manyTask}}</p></div>
            <form class="btns" method="post" enctype="multipart/form-data">
              <div class="actions">
                
              <!-- <div class="example-2"> эта хуйня ломает описание задачи -->
                <div class="form-group">
                  <input type="file" name="file" id="file" class="input-file" multiple>
                  <label for="file" class="btn">
                    <span class="btn btn-tertiary js-labelFile">Загрузить файл</span>
                  </label>
                <!-- </div> -->
              </div>
              </div>
               </form>
              </div>
              <form  method="POST">
                <div class="chat_name">
                  <ul class="chat-massages">
                      <li class="chat-mass">
                         <div class="mass-ava"> </div>
                            <div class="mass-text">
                               
                                    тут огромный огромный огромный огромныйогромный огромныйогромный огромныйогромный огромныйогромный огромный текст
                                
                            </div>
                      </li>
                      <li class="chat-mass">
                        <div class="mass-ava"> </div>
                           <div class="mass-text">
                               
                                   тут еще больше больше большк большк большк большк большк больше больше большк большк большк большк большкбольше больше большк большк большк большк большкбольше больше большк большк большк большк большкбольше больше большк большк большк большк большкбольше больше большк большк большк большк большкбольше больше большк большк большк большк большкбольше больше большк большк большк большк большк текст
                               
                           </div>
                     </li>
                     
                  </ul>
                </div>
                <div class="chat">
                    <input class="chat-text" name="text" type="text">
                    <input  class="chat-send" type="submit" value="отправить сообщение">
                    </div>
            </form>
              <!-- <button class="finish-task" value="{{u.id}}" name="task_into"><span>Отправить на проверку</span></button> -->
              <div class="cl-btn-7"></div>
              </div>
            </li>
            {% endif %}
    
            {% endif %}
    
          </ul>
          {% endif %}
          {% endfor %}
 
 <!-- Блок "выполнено" -->
 {% for u in tasks %}
 {% if current_user.id == u.idUser %}
 <ul class="tasks_list" id="content-3">
    {% if u.statusСompleted == "Сomplete" %}
    <li>
    <a class ="triggerTask" href="#">
     <div class="task-card" >
 
       <p class="task-fname">{{u.nameTask}}</p>

 </div>
 </a>
       <div class = "task" id="tg{{u.id}}">
         <div class="task-up">
           <div class="finish-task"><a  value="{{u.id}}" name="task_into"> <p>Отправить на проверку</p></a></div>
           <div class="downloads"> <a href=""> <p> Загруженные файлы</p></a></div>
   </div>
         <div class="task-info">
         <p class="task_name">{{u.nameTask}}</p>
         <p class="proj_name"><span>Для проекта: </span>{{u.idProject}}</p>
         <p class="task-descript">{{u.descTask}}</p> 
         <div class="task-date"> <p> {{u.timeTask}}</p></div>
         <div class="task-money"> <p>{{u.manyTask}}</p></div>
         <!-- <button class="finish-task" value="{{u.id}}" name="task_into"><span>Отправить на проверку</span></button> -->
         <div class="cl-btn-7"></div>
         </div>

            
        </li>

        {% endif %}
        {% endif %}
      </ul>
      {% endfor %}
    </div>

    
      

<script>
//         $(document).ready(function() {
//     $('a.triggerTask').click( function(event){
//         var clickId = $(this).attr('id');// значения открытыго проекта 
//         $('.task#tg'+ clickId).css('display', 'block');
//     });

//     $('.cl-btn-7').click( function(){
//         $('.task#tg').css('display', 'none');
//     });
// });
$(document).ready(function(){
        $("a.triggerTask").on('click', function(){
            $(".task").css('display','block');
            return false;
        });

        $(".cl-btn-7").on('click', function(){
            $(".task").css('display','none');
            return false;
        });
    });


</script>

{% endblock %}
